ðŸ§  æ•´ä½“æµç¨‹å›¾è§£ï¼š
bash
Copy
Edit
ä½ è¿è¡Œï¼š
â†’ echo "123" > /data/a.txt

Linux å®žé™…åšäº†è¿™äº›ï¼š

1ï¸âƒ£ å†™å…¥ VFS è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ  
2ï¸âƒ£ å†™å…¥ Page Cacheï¼ˆå†…å­˜ä¸­çš„ç¼“å†²ï¼‰ âœ…
3ï¸âƒ£ åŽå°å»¶è¿Ÿåˆ·æ–°ï¼ˆflushï¼‰åˆ°æŒ‚è½½ç£ç›˜ vdb1


ðŸ” è¯¦ç»†è§£é‡Šå…³é”®è¿‡ç¨‹ï¼š
âœ… Step 1ï¼šä½ å†™å…¥äº†æŒ‚è½½ç›®å½• /data
å› ä¸º /data æ˜¯æŒ‚è½½ç‚¹

æ‰€ä»¥æ“ä½œç³»ç»ŸçŸ¥é“ï¼Œè¿™ä¸ªæ–‡ä»¶æœ€ç»ˆè¦å½’å±žåˆ° /dev/vdb1 ä¸Š


âœ… Step 2ï¼šå†™å…¥ Page Cacheï¼ˆå†…å­˜ï¼‰
Linux ä¼šå…ˆæŠŠæ•°æ®å†™åˆ°å†…å­˜ä¸­çš„â€œé¡µé¢ç¼“å­˜ï¼ˆpage cacheï¼‰â€

è¿™æ ·èƒ½æé«˜æ€§èƒ½ï¼ˆä¸éœ€è¦æ¯æ¬¡éƒ½ç­‰ç£ç›˜å†™å®Œæ‰è¿”å›žï¼‰

ðŸ§  ç±»æ¯”å°±æ˜¯ï¼šâ€œä½ åœ¨æ–‡æ¡£é‡Œæ‰“äº†å­—ï¼Œä½†è¿˜æ²¡ç‚¹ä¿å­˜â€

âœ… Step 3ï¼šç³»ç»Ÿå®šæœŸåˆ·ç›˜ï¼ˆsync / flushï¼‰
Linux ä¼šå®šæ—¶è°ƒç”¨ flush æŠŠç¼“å­˜å†…å®¹å†™å›žç£ç›˜

æˆ–è€…ä½ å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

cd /data
echo "hello" > a.txt

# æŸ¥çœ‹ç³»ç»Ÿæœ‰æ²¡æœ‰åˆ·ç›˜ï¼š
cat /proc/meminfo | grep Dirty

# å¼ºåˆ¶åˆ·ç›˜ï¼š
sync

-------------------------------------
âœ… æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š
âœ… Linux æ”¯æŒä½ æŠŠä»»ä½•ç›®å½•å½“æŒ‚è½½ç‚¹ï¼
ä½† /mntã€/media æ˜¯å®˜æ–¹æŽ¨èçš„â€œå…¬å…±æŒ‚è½½åŒºâ€ï¼Œä»…ä»…æ˜¯çº¦å®šä¿—æˆï¼Œä¸æ˜¯å¼ºåˆ¶ï¼
------------------------------------------
è·¯å¾„	æ„ä¹‰å’Œæƒ¯ä¾‹è¯´æ˜Ž
/mnt	âœ… å®˜æ–¹å»ºè®®ï¼šä¸´æ—¶æŒ‚è½½æ‰‹åŠ¨ç£ç›˜çš„ç›®å½•ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
/media	âœ… ç³»ç»Ÿè‡ªåŠ¨æŒ‚è½½ U ç›˜ / å…‰é©± / SD å¡ç­‰å¤–éƒ¨è®¾å¤‡
/data	âœ… ç”¨æˆ·/å¼€å‘è€…è‡ªå·±åˆ›å»ºçš„â€œä¸šåŠ¡æ•°æ®æŒ‚è½½ç‚¹â€ï¼ˆå¸¸è§äºŽäº‘/æœåŠ¡å™¨ï¼‰

ðŸ“Œ æ‰€ä»¥ä½ çœ‹åˆ°å¾ˆå¤šæ•°æ®åº“ã€æ—¥å¿—æœåŠ¡ä¼šæŒ‚åœ¨ /dataã€/logã€/opt/data â€”â€” éƒ½æ˜¯å¯ä»¥çš„ï¼Œåªè¦ä½ å…ˆ mkdir

------------------------
ç›®æ ‡ç”¨é€”	æŽ¨èæŒ‚è½½ç›®å½•	åŽŸå› 
ä¸´æ—¶æ‰‹åŠ¨æŒ‚è½½ ISO	/mnt/iso	/mnt æ˜¯æ ‡å‡†æŒ‚è½½åŒº
æ’å…¥ U ç›˜	/media/usb0	è‡ªåŠ¨æŒ‚è½½ç³»ç»Ÿç”¨çš„
æ•°æ®åº“æ•°æ®ç›˜	âœ… /data	ç®€æ´ç›´è§‚ï¼ŒæœåŠ¡å™¨é€šç”¨
docker æŒ‚è½½å·	/var/lib/docker	docker è‡ªå·±ç®¡ç†è·¯å¾„
-------------------------------

-------------------------------------------------------
root@7ac9b61912df:/bustub/build/bin# lsblk
NAME  MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
loop0   7:0    0 531.9M  1 loop 
loop1   7:1    0   625M  1 loop 
sda     8:0    0 388.4M  1 disk 
sdb     8:16   0     8G  0 disk [SWAP]
sdc     8:32   0     1T  0 disk /bustub
sdd     8:48   0     1T  0 disk 
sde     8:64   0     1T  0 disk 
sdf     8:80   0     1T  0 disk /etc/hosts
                                /etc/hostname
                                /etc/resolv.conf
root@7ac9b61912df:/bustub/build/bin# é‚£ä¹ˆçŽ°åœ¨è¿™ä¸ªæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¯¦ç»†è§£é‡Š
---------------------------
lsblk
è¿™æ˜¯æŸ¥çœ‹ç³»ç»Ÿä¸­ æ‰€æœ‰å—è®¾å¤‡ï¼ˆBlock Devicesï¼‰ çš„å‘½ä»¤ï¼Œè¿”å›žçš„æ˜¯ä½ ç³»ç»Ÿé‡Œæ¯ä¸ªâ€œç¡¬ç›˜â€çš„çŠ¶æ€ã€‚

ðŸ“Š è¿™æ˜¯ä½ å½“å‰è®¾å¤‡ç»“æž„è§£æžï¼ˆé€è¡Œåˆ†æžï¼‰ï¼š
åç§°	ç±»åž‹	å®¹é‡	æ˜¯å¦æŒ‚è½½ä¸­	æŒ‚è½½ä½ç½®è¯´æ˜Ž
loop0	loop	531.9M	æ˜¯	æ˜¯ä¸€ä¸ªåªè¯»æŒ‚è½½ï¼ˆå¯èƒ½æ˜¯ snap è½¯ä»¶åŒ…ï¼‰
loop1	loop	625M	æ˜¯	åŒä¸Š
sda	ç£ç›˜	388.4M	æ˜¯	ç”¨ä½œæŸä¸ªç³»ç»Ÿç»„ä»¶ï¼Œå¦‚ initrd
sdb	ç£ç›˜	8G	å¦	âš ï¸ ä½œä¸º swap åˆ†åŒºï¼ŒæœªæŒ‚è½½
sdc	ç£ç›˜	1T	âœ… æ˜¯	âœ… æŒ‚è½½åˆ°äº† /bustubï¼Œä½ å½“å‰å·¥ä½œç›®å½•
sdd	ç£ç›˜	1T	âŒ å¦	æ²¡æœ‰æŒ‚è½½ï¼Œç”¨äºŽæŒ‚åˆ° /data æœ€åˆé€‚
sde	ç£ç›˜	1T	âŒ å¦	åŒä¸Š
sdf	ç£ç›˜	1T	âœ… æ˜¯	ç³»ç»ŸæŒ‚è½½çš„ /etc/hosts ç­‰é…ç½®æ˜ å°„


------
âœ… æœ€é‡è¦çš„è§£é‡Šï¼š
âœ… sdc â€” ä½ æ­£åœ¨ä½¿ç”¨çš„æŒ‚è½½ç‚¹
bash
Copy
Edit
sdc     8:32   0     1T  0 disk /bustub
è¯´æ˜Žä½ æ•´ä¸ª /bustub ç›®å½•ï¼Œæ˜¯ä»Žä¸€å— 1T ç¡¬ç›˜ sdc æŒ‚è½½å‡ºæ¥çš„ã€‚

ä½ çŽ°åœ¨çš„è·¯å¾„æ˜¯ï¼š

/bustub/build/bin
å°±æ„å‘³ç€ä½ æ‰€æœ‰ Bustub é¡¹ç›®çš„è¯»å†™ï¼Œæœ€ç»ˆéƒ½å†™è¿›äº† sdc ç›˜ä¸­ï¼
------------------------

âœ… sdd, sde â€” ä½ æœªæ¥å¯ä»¥æŒ‚è½½çš„æ•°æ®ç›˜
bash
Copy
Edit
sdd     8:48   0     1T  0 disk
sde     8:64   0     1T  0 disk
âœ… è¿™äº›æ˜¯å®Œå…¨ç©ºé—²çš„ç¡¬ç›˜ï¼Œä½ å¯ä»¥ç”¨å®ƒä»¬æ¥æŒ‚è½½åˆ° /data æˆ– /mnt/data æ¥ç»ƒä¹ â€œæŒ‚è½½+å†™å…¥â€

âœ… sdf â€” é…ç½®æŒ‚è½½æ˜ å°„
bash
Copy
Edit
sdf     8:80   0     1T  0 disk /etc/hosts /etc/resolv.conf
è¿™æ˜¯å®¹å™¨ç³»ç»ŸæŒ‚è½½è¿›æ¥çš„ç‰¹æ®Šç³»ç»Ÿæ–‡ä»¶é…ç½®ç›˜ï¼Œä¸ç”¨åŠ¨å®ƒã€‚


----------------------------
âœ… ä½ ä¸‹ä¸€æ­¥å¯ä»¥åšä»€ä¹ˆï¼Ÿ
ðŸ”¹1ï¸âƒ£ åˆ›å»ºæŒ‚è½½ç‚¹ /data
bash
Copy
Edit
mkdir /data
ðŸ”¹2ï¸âƒ£ æ‰‹åŠ¨æŒ‚è½½ä¸€ä¸ªç©ºç›˜
bash
Copy
Edit
mount /dev/sdd /data
æˆ–è€…ï¼ˆå¦‚æžœ sdd æ²¡æœ‰åˆ†åŒºï¼‰ï¼š

bash
Copy
Edit
mkfs.ext4 /dev/sdd      # æ ¼å¼åŒ–æˆ ext4 æ–‡ä»¶ç³»ç»Ÿï¼ˆâš ï¸ä»…é™é¦–æ¬¡ä½¿ç”¨ï¼‰
mount /dev/sdd /data    # ç„¶åŽæŒ‚è½½
-------------------------------
ðŸ”¹2ï¸âƒ£ æ‰‹åŠ¨æŒ‚è½½ä¸€ä¸ªç©ºç›˜
bash
Copy
Edit
mount /dev/sdd /data
æˆ–è€…ï¼ˆå¦‚æžœ sdd æ²¡æœ‰åˆ†åŒºï¼‰ï¼š

bash
Copy
Edit
mkfs.ext4 /dev/sdd      # æ ¼å¼åŒ–æˆ ext4 æ–‡ä»¶ç³»ç»Ÿï¼ˆâš ï¸ä»…é™é¦–æ¬¡ä½¿ç”¨ï¼‰
mount /dev/sdd /data    # ç„¶åŽæŒ‚è½½
ðŸ”¹3ï¸âƒ£ å†™å…¥æµ‹è¯•
bash
Copy
Edit
cd /data
echo "hello bustub" > a.txt
ls












